# –°—Ç—Ä–∞—Ç–µ–≥–∏—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –¥–ª—è Shard Legends: Clan Wars

## –û–±–∑–æ—Ä

–î–∞–Ω–Ω—ã–π –¥–æ–∫—É–º–µ–Ω—Ç –æ–ø–∏—Å—ã–≤–∞–µ—Ç —Å—Ç—Ä–∞—Ç–µ–≥–∏—é –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –¥–ª—è –≤—Å–µ—Ö –Ω–∏–∂–Ω–∏—Ö —Å—Ä–µ–¥ (dev, test, stage) –ø—Ä–æ–µ–∫—Ç–∞. –û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã: –ø—Ä–æ—Å—Ç–æ—Ç–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏, –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞, –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –ø–æ–ª—å–∑–∞.

**–ö–ª—é—á–µ–≤—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã:**
- üéØ **KISS** - Keep It Simple, Stupid
- üì¶ **All-in-One** - –ú–∏–Ω–∏–º—É–º –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –¥–ª—è —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è
- üöÄ **Quick Start** - –ë—ã—Å—Ç—Ä—ã–π –∑–∞–ø—É—Å–∫ –∏–∑ –∫–æ—Ä–æ–±–∫–∏
- üí∞ **Cost Effective** - –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ —Ä–µ—Å—É—Ä—Å–∞–º

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ä–µ—à–µ–Ω–∏—è

### –í—ã–±—Ä–∞–Ω–Ω—ã–π —Å—Ç–µ–∫

–î–ª—è MVP –º—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º **–º–∏–Ω–∏–º–∞–ª–∏—Å—Ç–∏—á–Ω—ã–π, –Ω–æ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–π —Å—Ç–µ–∫**:

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  –ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã   ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ   Promtail   ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ      Loki       ‚îÇ
‚îÇ  (stdout logs)  ‚îÇ     ‚îÇ (collector)  ‚îÇ     ‚îÇ  (log storage)  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                                      ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê            ‚îÇ
‚îÇ  –ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã   ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ  Prometheus  ‚îÇ            ‚îÇ
‚îÇ   (/metrics)    ‚îÇ     ‚îÇ  (metrics)   ‚îÇ            ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò            ‚îÇ
                                ‚îÇ                    ‚îÇ
                                ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                          ‚îÇ
                                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                                    ‚îÇ   Grafana   ‚îÇ
                                    ‚îÇ(dashboards) ‚îÇ
                                    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

1. **Loki** - –õ–µ–≥–∫–æ–≤–µ—Å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —Ö—Ä–∞–Ω–µ–Ω–∏—è –ª–æ–≥–æ–≤ –æ—Ç Grafana Labs
   - –ù–µ —Ç—Ä–µ–±—É–µ—Ç –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏ (–∫–∞–∫ ElasticSearch)
   - –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ —Ä–µ—Å—É—Ä—Å–∞–º
   - –û—Ç–ª–∏—á–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å Docker labels
   - **–ü–æ—Ä—Ç**: 15100

2. **Promtail** - –ê–≥–µ–Ω—Ç —Å–±–æ—Ä–∞ –ª–æ–≥–æ–≤ –¥–ª—è Loki
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–±–∏—Ä–∞–µ—Ç –ª–æ–≥–∏ –∏–∑ Docker
   - –î–æ–±–∞–≤–ª—è–µ—Ç –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ (labels)
   - –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
   - **–ë–µ–∑ –≤–Ω–µ—à–Ω–µ–≥–æ –ø–æ—Ä—Ç–∞** (–≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π —Å–µ—Ä–≤–∏—Å)

3. **Prometheus** - –°–∏—Å—Ç–µ–º–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –º–µ—Ç—Ä–∏–∫
   - Scraping –º–µ—Ç—Ä–∏–∫ –∏–∑ /metrics —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤
   - –•—Ä–∞–Ω–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ä—è–¥–æ–≤
   - –ê–ª–µ—Ä—Ç–∏–Ω–≥ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
   - **–ü–æ—Ä—Ç**: 15090

4. **Grafana** - –ï–¥–∏–Ω–∞—è —Ç–æ—á–∫–∞ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏
   - –î–∞—à–±–æ—Ä–¥—ã –¥–ª—è –ª–æ–≥–æ–≤ –∏ –º–µ—Ç—Ä–∏–∫
   - –ì–æ—Ç–æ–≤—ã–µ —à–∞–±–ª–æ–Ω—ã –¥–ª—è Docker/–º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–æ–≤
   - –ê–ª–µ—Ä—Ç—ã –ø–æ email/Telegram
   - **–ü–æ—Ä—Ç**: 15000

5. **cAdvisor** - –ú–µ—Ç—Ä–∏–∫–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Å–±–æ—Ä –º–µ—Ç—Ä–∏–∫ Docker
   - CPU, –ø–∞–º—è—Ç—å, —Å–µ—Ç—å, –¥–∏—Å–∫
   - **–ü–æ—Ä—Ç**: 15081

### –ü–æ—Ä—Ç—ã –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

| –°–µ—Ä–≤–∏—Å | –í–Ω–µ—à–Ω–∏–π –ø–æ—Ä—Ç | –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –ø–æ—Ä—Ç | –û–ø–∏—Å–∞–Ω–∏–µ |
|--------|-------------|----------------|----------|
| Grafana | 15000 | 3000 | Web UI –¥–∞—à–±–æ—Ä–¥–æ–≤ |
| Prometheus | 15090 | 9090 | Web UI –º–µ—Ç—Ä–∏–∫ |
| Loki | 15100 | 3100 | API –ª–æ–≥–æ–≤ |
| cAdvisor | 15081 | 8080 | –ú–µ—Ç—Ä–∏–∫–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ |

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ**: –í—Å–µ –ø–æ—Ä—Ç—ã –ø—Ä–∏–≤—è–∑–∞–Ω—ã –∫ 127.0.0.1 –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏.

## –°—Ç–∞–Ω–¥–∞—Ä—Ç—ã –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è

### 1. –§–æ—Ä–º–∞—Ç –ª–æ–≥–æ–≤

**–í—Å–µ —Å–µ—Ä–≤–∏—Å—ã –¥–æ–ª–∂–Ω—ã –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å –≤ JSON —Ñ–æ—Ä–º–∞—Ç–µ:**

```json
{
  "timestamp": "2024-12-22T10:30:45Z",
  "level": "info",
  "service": "auth-service",
  "trace_id": "abc123",
  "message": "User authenticated",
  "user_id": "123",
  "duration_ms": 45
}
```

### 2. –£—Ä–æ–≤–Ω–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è

- **ERROR** - –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏, —Ç—Ä–µ–±—É—é—â–∏–µ –≤–Ω–∏–º–∞–Ω–∏—è
- **WARN** - –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è (rate limit, deprecated API)
- **INFO** - –í–∞–∂–Ω—ã–µ –±–∏–∑–Ω–µ—Å-—Å–æ–±—ã—Ç–∏—è (login, purchase)
- **DEBUG** - –û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è (–Ω–µ –≤ production)

### 3. –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è

```go
type LogEntry struct {
    Timestamp string `json:"timestamp"`      // ISO 8601
    Level     string `json:"level"`          // error|warn|info|debug
    Service   string `json:"service"`        // –ò–º—è —Å–µ—Ä–≤–∏—Å–∞
    TraceID   string `json:"trace_id"`       // –î–ª—è distributed tracing
    Message   string `json:"message"`        // –ß–µ–ª–æ–≤–µ–∫–æ—á–∏—Ç–∞–µ–º–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
}
```

### 4. –ß—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

**–ù–ò–ö–û–ì–î–ê –Ω–µ –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å:**
- –ü–∞—Ä–æ–ª–∏ –∏ —Ç–æ–∫–µ–Ω—ã
- –ü–æ–ª–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –±–∞–Ω–∫–æ–≤—Å–∫–∏—Ö –∫–∞—Ä—Ç
- –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (–±–µ–∑ –æ–±–µ–∑–ª–∏—á–∏–≤–∞–Ω–∏—è)

**–û–±–µ–∑–ª–∏—á–∏–≤–∞–Ω–∏–µ:**
```json
{
  "user_email": "jo***@example.com",
  "phone": "+7******1234"
}
```

## –°—Ç–∞–Ω–¥–∞—Ä—Ç—ã –º–µ—Ç—Ä–∏–∫

### 1. –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞

```prometheus
# HTTP –º–µ—Ç—Ä–∏–∫–∏
http_requests_total{service="auth-service",method="POST",endpoint="/auth",status="200"}
http_request_duration_seconds{service="auth-service",method="POST",endpoint="/auth"}

# –ë–∏–∑–Ω–µ—Å-–º–µ—Ç—Ä–∏–∫–∏
business_events_total{service="auth-service",event="user_login",status="success"}
business_events_total{service="auth-service",event="user_registration",status="success"}

# –°–∏—Å—Ç–µ–º–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ cAdvisor)
container_cpu_usage_seconds_total
container_memory_usage_bytes
```

### 2. –≠–Ω–¥–ø–æ–∏–Ω—Ç –º–µ—Ç—Ä–∏–∫

–ö–∞–∂–¥—ã–π —Å–µ—Ä–≤–∏—Å –¥–æ–ª–∂–µ–Ω —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –º–µ—Ç—Ä–∏–∫–∏ –Ω–∞ `GET /metrics` –≤ —Ñ–æ—Ä–º–∞—Ç–µ Prometheus:

```go
// –ü—Ä–∏–º–µ—Ä –¥–ª—è Go —Å promhttp
http.Handle("/metrics", promhttp.Handler())
```

## Docker Compose –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### monitoring-stack.yml

```yaml
version: '3.8'

services:
  # Loki - —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –ª–æ–≥–æ–≤
  loki:
    image: grafana/loki:2.9.0
    container_name: slcw-loki
    ports:
      - "3100:3100"
    volumes:
      - loki-data:/loki
      - ./monitoring/loki-config.yml:/etc/loki/local-config.yaml
    command: -config.file=/etc/loki/local-config.yaml
    networks:
      - monitoring

  # Promtail - —Å–±–æ—Ä—â–∏–∫ –ª–æ–≥–æ–≤
  promtail:
    image: grafana/promtail:2.9.0
    container_name: slcw-promtail
    volumes:
      - /var/log:/var/log:ro
      - /var/lib/docker/containers:/var/lib/docker/containers:ro
      - ./monitoring/promtail-config.yml:/etc/promtail/config.yml
    command: -config.file=/etc/promtail/config.yml
    networks:
      - monitoring
    depends_on:
      - loki

  # Prometheus - –º–µ—Ç—Ä–∏–∫–∏
  prometheus:
    image: prom/prometheus:v2.45.0
    container_name: slcw-prometheus
    ports:
      - "9090:9090"
    volumes:
      - prometheus-data:/prometheus
      - ./monitoring/prometheus.yml:/etc/prometheus/prometheus.yml
    command:
      - '--config.file=/etc/prometheus/prometheus.yml'
      - '--storage.tsdb.path=/prometheus'
      - '--storage.tsdb.retention.time=7d'
    networks:
      - monitoring

  # Grafana - –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è
  grafana:
    image: grafana/grafana:10.0.0
    container_name: slcw-grafana
    ports:
      - "3000:3000"
    environment:
      - GF_SECURITY_ADMIN_PASSWORD=admin # –ò–∑–º–µ–Ω–∏—Ç—å –≤ production!
      - GF_USERS_ALLOW_SIGN_UP=false
    volumes:
      - grafana-data:/var/lib/grafana
      - ./monitoring/grafana/provisioning:/etc/grafana/provisioning
    networks:
      - monitoring
    depends_on:
      - loki
      - prometheus

  # cAdvisor - –º–µ—Ç—Ä–∏–∫–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
  cadvisor:
    image: gcr.io/cadvisor/cadvisor:v0.47.0
    container_name: slcw-cadvisor
    ports:
      - "8080:8080"
    volumes:
      - /:/rootfs:ro
      - /var/run:/var/run:ro
      - /sys:/sys:ro
      - /var/lib/docker/:/var/lib/docker:ro
    networks:
      - monitoring

networks:
  monitoring:
    external: true
    name: slcw-monitoring

volumes:
  loki-data:
  prometheus-data:
  grafana-data:
```

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–æ–≤

### 1. Docker labels –¥–ª—è –ª–æ–≥–æ–≤

```yaml
# –í docker-compose.yml –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞
auth-service:
  labels:
    - "logging.service=auth-service"
    - "logging.environment=${ENVIRONMENT:-dev}"
  logging:
    driver: "json-file"
    options:
      max-size: "10m"
      max-file: "3"
      labels: "logging.service,logging.environment"
```

### 2. –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

**Go –ø—Ä–∏–º–µ—Ä —Å slog:**
```go
logger := slog.New(slog.NewJSONHandler(os.Stdout, &slog.HandlerOptions{
    Level: slog.LevelInfo,
}))

logger = logger.With(
    "service", "auth-service",
    "version", "1.0.0",
)

// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
logger.Info("User authenticated",
    "user_id", userID,
    "duration_ms", duration.Milliseconds(),
    "trace_id", traceID,
)
```

## –î–∞—à–±–æ—Ä–¥—ã Grafana

### 1. –°–∏—Å—Ç–µ–º–Ω—ã–π –¥–∞—à–±–æ—Ä–¥

**–ü–∞–Ω–µ–ª–∏:**
- CPU –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–æ —Å–µ—Ä–≤–∏—Å–∞–º
- –ü–∞–º—è—Ç—å –ø–æ —Å–µ—Ä–≤–∏—Å–∞–º
- –°–µ—Ç–µ–≤–æ–π —Ç—Ä–∞—Ñ–∏–∫
- Disk I/O

### 2. –ë–∏–∑–Ω–µ—Å-–¥–∞—à–±–æ—Ä–¥

**–ü–∞–Ω–µ–ª–∏:**
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–π/–ª–æ–≥–∏–Ω–æ–≤
- –ê–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
- –û—à–∏–±–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
- –°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞ API

### 3. –î–∞—à–±–æ—Ä–¥ –æ—à–∏–±–æ–∫

**–ü–∞–Ω–µ–ª–∏:**
- Error rate –ø–æ —Å–µ—Ä–≤–∏—Å–∞–º
- –ü–æ—Å–ª–µ–¥–Ω–∏–µ –æ—à–∏–±–∫–∏ (–ª–æ–≥–∏)
- Top 10 –æ—à–∏–±–æ–∫
- –ê–ª–µ—Ä—Ç—ã

## –ê–ª–µ—Ä—Ç–∏–Ω–≥

### –ë–∞–∑–æ–≤—ã–µ –ø—Ä–∞–≤–∏–ª–∞ –∞–ª–µ—Ä—Ç–æ–≤

```yaml
# prometheus/alerts.yml
groups:
  - name: basic
    rules:
      - alert: ServiceDown
        expr: up == 0
        for: 5m
        annotations:
          summary: "Service {{ $labels.job }} is down"
          
      - alert: HighErrorRate
        expr: rate(http_requests_total{status=~"5.."}[5m]) > 0.05
        for: 5m
        annotations:
          summary: "High error rate in {{ $labels.service }}"
          
      - alert: HighMemoryUsage
        expr: container_memory_usage_bytes / container_spec_memory_limit_bytes > 0.9
        for: 5m
        annotations:
          summary: "High memory usage in {{ $labels.container_name }}"
```

## –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ

### 1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞

```bash
# –°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –¥–ª—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π
mkdir -p deploy/monitoring/{loki,promtail,prometheus,grafana/provisioning}

# –°–æ–∑–¥–∞–Ω–∏–µ —Å–µ—Ç–∏
docker network create slcw-monitoring
```

### 2. –ó–∞–ø—É—Å–∫ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

```bash
# –ó–∞–ø—É—Å–∫ —Å—Ç–µ–∫–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
docker-compose -f deploy/monitoring/docker-compose.yml up -d

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
docker-compose -f deploy/monitoring/docker-compose.yml ps
```

### 3. –î–æ—Å—Ç—É–ø –∫ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞–º

- **Grafana**: http://localhost:15000 (admin/admin)
- **Prometheus**: http://localhost:15090  
- **Loki**: http://localhost:15100
- **cAdvisor**: http://localhost:15081

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ**: –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è 5-–∑–Ω–∞—á–Ω—ã–µ –ø–æ—Ä—Ç—ã –¥–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ —Å –æ—Å–Ω–æ–≤–Ω—ã–º–∏ —Å–µ—Ä–≤–∏—Å–∞–º–∏.

### 4. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å–µ—Ä–≤–∏—Å–∞–º–∏

–û–±–Ω–æ–≤–∏—Ç–µ `deploy/dev/docker-compose.yml` –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ –∫ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥—É:

```yaml
# –ü—Ä–∏–º–µ—Ä –¥–ª—è –ª—é–±–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞
your-service:
  # ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è ...
  
  # –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –æ–±–µ–∏–º —Å–µ—Ç—è–º
  networks:
    - slcw-dev        # –î–ª—è –æ–±—â–µ–Ω–∏—è —Å –¥—Ä—É–≥–∏–º–∏ —Å–µ—Ä–≤–∏—Å–∞–º–∏
    - slcw-monitoring # –î–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
  
  # –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ (–¥–ª—è Promtail)
  labels:
    - "logging.service=your-service"
    - "logging.environment=${ENVIRONMENT:-dev}"
  logging:
    driver: "json-file"
    options:
      max-size: "10m"
      max-file: "3"
      labels: "logging.service,logging.environment"

# –î–æ–±–∞–≤–∏—Ç—å —Å–µ—Ç–∏ –≤ –∫–æ–Ω–µ—Ü —Ñ–∞–π–ª–∞
networks:
  slcw-dev:
    external: false
    name: slcw-dev
  slcw-monitoring:
    external: true
    name: slcw-monitoring
```

–ü–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:

```bash
# 1. –ó–∞–ø—É—Å—Ç–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ (—Å–æ–∑–¥–∞—Å—Ç —Å–µ—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
cd deploy/monitoring
docker-compose up -d

# 2. –ü–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å –æ—Å–Ω–æ–≤–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã
cd ../dev
docker-compose down
docker-compose up -d
```

## –•—Ä–∞–Ω–µ–Ω–∏–µ –∏ —Ä–æ—Ç–∞—Ü–∏—è

### –ü–æ–ª–∏—Ç–∏–∫–∏ —Ö—Ä–∞–Ω–µ–Ω–∏—è

- **–õ–æ–≥–∏**: 7 –¥–Ω–µ–π (Loki)
- **–ú–µ—Ç—Ä–∏–∫–∏**: 7 –¥–Ω–µ–π (Prometheus)
- **–î–∞—à–±–æ—Ä–¥—ã**: Persistent (Grafana)

### Backup —Å—Ç—Ä–∞—Ç–µ–≥–∏—è

```bash
# Backup —Å–∫—Ä–∏–ø—Ç (–∑–∞–ø—É—Å–∫–∞—Ç—å –ø–æ cron)
#!/bin/bash
DATE=$(date +%Y%m%d)
docker exec slcw-prometheus tar czf /tmp/prometheus-backup-$DATE.tar.gz /prometheus
docker exec slcw-grafana tar czf /tmp/grafana-backup-$DATE.tar.gz /var/lib/grafana
# –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ backup —Å–µ—Ä–≤–µ—Ä
```

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤

### –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞

```bash
# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ —Å–µ—Ä–≤–∏—Å–∞
docker logs -f slcw-auth-service-dev

# –ü—Ä–æ—Å–º–æ—Ç—Ä –º–µ—Ç—Ä–∏–∫
curl http://localhost:9000/metrics

# Grafana UI
open http://localhost:3000
```

### –û—Ç–ª–∞–¥–∫–∞

1. **Trace ID** - –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤ —á–µ—Ä–µ–∑ —Å–µ—Ä–≤–∏—Å—ã
2. **Correlation** - –°–≤—è–∑—ã–≤–∞–π—Ç–µ –ª–æ–≥–∏ —Å –º–µ—Ç—Ä–∏–∫–∞–º–∏ —á–µ—Ä–µ–∑ labels
3. **Dashboards** - –°–æ–∑–¥–∞–≤–∞–π—Ç–µ –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–∞—à–±–æ—Ä–¥—ã –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

## Best Practices

### ‚úÖ DO:
- –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ –≤–∞–∂–Ω—ã–µ –±–∏–∑–Ω–µ—Å-—Å–æ–±—ã—Ç–∏—è
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ª–æ–≥–∏ (JSON)
- –î–æ–±–∞–≤–ª—è—Ç—å trace_id –¥–ª—è distributed tracing
- –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –±–∏–∑–Ω–µ—Å-–º–µ—Ç—Ä–∏–∫–∏
- –ù–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å –∞–ª–µ—Ä—Ç—ã –Ω–∞ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Å–æ–±—ã—Ç–∏—è

### ‚ùå DON'T:
- –ù–µ –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
- –ù–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å print/console.log –≤ production
- –ù–µ –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å –æ—à–∏–±–∫–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
- –ù–µ —Å–æ–∑–¥–∞–≤–∞—Ç—å —Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –º–µ—Ç—Ä–∏–∫ (cardinality)

## Roadmap

### Phase 1 (MVP) ‚úÖ
- [x] –ë–∞–∑–æ–≤—ã–π —Å—Ç–µ–∫ Loki + Prometheus + Grafana
- [x] –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- [x] –û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏
- [x] –ë–∞–∑–æ–≤—ã–µ –¥–∞—à–±–æ—Ä–¥—ã

### Phase 2
- [ ] Distributed tracing (Jaeger/Tempo)
- [ ] –ê–ª–µ—Ä—Ç–∏–Ω–≥ –≤ Telegram
- [ ] –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –¥–∞—à–±–æ—Ä–¥—ã
- [ ] SLO/SLI –º–µ—Ç—Ä–∏–∫–∏

### Phase 3
- [ ] APM (Application Performance Monitoring)
- [ ] –õ–æ–≥–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ (WAF, IDS)
- [ ] ML-based anomaly detection
- [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –≤–Ω–µ—à–Ω–∏–º–∏ —Å–∏—Å—Ç–µ–º–∞–º–∏

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–î–∞–Ω–Ω–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç:
- üöÄ **–ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç** - —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –∑–∞ 5 –º–∏–Ω—É—Ç
- üí° **–ü—Ä–æ—Å—Ç–æ—Ç—É** - –º–∏–Ω–∏–º—É–º –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- üìä **–ü–æ–ª–Ω–æ—Ç—É** - –ª–æ–≥–∏ + –º–µ—Ç—Ä–∏–∫–∏ + –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è
- üí∞ **–≠–∫–æ–Ω–æ–º–∏—á–Ω–æ—Å—Ç—å** - —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ 2GB RAM
- üîß **–†–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å** - –ª–µ–≥–∫–æ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

–î–ª—è production —Å—Ä–µ–¥—ã –Ω–∞ Kubernetes –±—É–¥–µ—Ç –æ—Ç–¥–µ–ª—å–Ω–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è —Å —É—á–µ—Ç–æ–º cloud-native –ø–æ–¥—Ö–æ–¥–æ–≤.