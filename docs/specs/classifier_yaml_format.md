# Формат YAML для описания классификаторов

Данный документ описывает **единый** формат `*.yaml`-файлов, из которых автоматически генерируются SQL-миграции для заполнения таблиц `inventory.classifiers` и `inventory.classifier_items`.

> Аналогично `item_yaml_format.md`, главный принцип — декларативное описание данных без технических деталей загрузки.

---

## 1. Общая структура файла

```yaml
classifiers:                  # ОБЯЗАТЕЛЬНО. Массив классификаторов
  - id: <uuid>                # ОБЯЗАТЕЛЬНО. Постоянный UUID v4 классификатора
    code: <string>            # ОБЯЗАТЕЛЬНО. Уникальный код (snake_case)
    description: <string>     # ОБЯЗАТЕЛЬНО. Описание на русском языке

    items:                    # ОБЯЗАТЕЛЬНО. Список элементов классификатора
      - id: <uuid>            # ОБЯЗАТЕЛЬНО. Постоянный UUID v4 элемента
        code: <string>        # ОБЯЗАТЕЛЬНО. Уникальный код в рамках классификатора
        description: <string> # ОБЯЗАТЕЛЬНО. Описание на русском языке
```

---

## 2. Описание полей

| Поле | Уровень | Тип | Обяз. | Примечание |
|------|---------|-----|-------|------------|
| `id` | classifier / item | UUID v4 | ✔ | Должен быть уникален во всём репозитории. Используется как PK при генерации SQL. |
| `code` | classifier / item | string | ✔ | Уникальный `snake_case`-код. Для классификатора — уникален во всей системе, для элемента — внутри своего классификатора. |
| `description` | classifier / item | string | ✔ | Текстовое описание на русском языке. Для элементов — краткое, ≤120 симв. |
| `items` | classifier | list | ✔ | Массив элементов классификатора. |

---

## 3. Пример (tool_quality_levels)

Ниже показан **полный** пример описания классификатора `tool_quality_levels` с использованием всех полей:

```yaml
classifiers:
  - id: 1ca275e1-7bf5-4e8d-ad1e-1b0b4cfb246f
    code: tool_quality_levels
    description: Доступные уровни качества для инструментов

    items:
      - id: 8b016e49-2e61-4109-a5a0-f3d98595be97
        code: wooden
        description: Деревянный инструмент

      - id: 1b9dc0d5-1e33-4c62-86dd-7247f459e0ff
        code: stone
        description: Каменный инструмент
        
      - id: c9bc2dc7-32d1-47a1-8c49-422d8e9ee3a1
        code: metal
        description: Металлический инструмент
        
      - id: 24c8eb88-b0ec-4aec-b2e1-89b39bdc7cfa
        code: diamond
        description: Бриллиантовый инструмент
```

---

## 4. Правила валидации

1. **Уникальность**
   * `code` классификатора — уникален во всей системе
   * `code` элемента — уникален **внутри** своего классификатора
   * `id` классификаторов/элементов не должны повторяться
2. **Ссылочная целостность**: элементы должны располагаться внутри существующего классификатора
3. **Описание**: обязательное поле `description` на русском языке
4. **Формат UUID**: v4, 36 симв, дефисы в позициях 9-14-19-24

---

## 5. Разбиение по файлам

Каждый YAML хранит **один** классификатор. Имя файла — `<classifier_code>.yaml`, например:
```
resource_type.yaml
quality_level.yaml
tool_quality_levels.yaml
```

Файлы располагаются в каталоге `game-data/classifiers/`.

---

## 6. Процесс загрузки в БД

Утилита/миграция должна:
1. **Не удалять** записи классификаторов;
2. Для указанного классификатора:
   * выполнить upsert всех элементов из YAML (`INSERT … ON CONFLICT (id)`);
   * при необходимости обновить `description`,  `is_active`.

Таким образом обеспечивается идемпотентная загрузка данных без удаления самого классификатора. 